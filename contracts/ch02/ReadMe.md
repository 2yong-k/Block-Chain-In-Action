# Chapter02. 스마트 컨트랙트
00. 스마트 컨트랙트란? 객체지향 프로그램에서 클래스와 유사한 독립적인 코드. '데이터와 함수를 가진 배포 가능한 코드 모듈. 함수는 확인, 검증, 그리고 전송된 메시지를 저장하는 등의 특정한 목적을 수행.
    - Dapp 기본 환경으로는 이더리움 플랫폼, 솔리디티 언어, 리믹스 통합 개발 환경

01. 스마트 컨트랙트 개념
    - 암호 화폐 이외의 디지털 자산을 위한 트랜잭션을 지원할 수 있는 프로그래밍을 가능하게 해줌
    - 비트코인 트랜잭션 vs. 스마트 컨트랙트 트랜잭션
        - 비트코인 트랜잭션: 모든 트랜잭션이 가치를 전송하기 위한 것
        - 스마트 컨트랙트 트랜잭션: 트랜잭션은 스마트 컨트랙트가 구현한 기능을 임베드한다.
    - 스마트 컨트랙트가 하는 일
        - 각 애플리케이션의 특수한 조건에 맞는 확인과 검증을 할 수 있는 비즈니스 로직 레이어를 표현
        - 블록체인에서 작동하기 위한 규칙의 명세를 설정
        - 탈중앙화 네트워크에서 자산의 전송을 위한 정책을 구현하기 쉽도록 한다.
        - 메시지나 다른 함수의 호출에 의해 실행되는 함수를 내장, 개인 주소나 다른 스마트 컨트랙트 주소가 이런 호출을 하게 된다. 블록체인의 분산 장부에 트랜잭션 일부로 기록되는데, 여기에는 입력 파라미터, 송신자의 주소, 타임스탬프 등과 같은 추가적인 메타 데이터를 포함한다.
        - 탈중앙화 블록체인 기반 애플리케이션을 위한 소프트웨어 기반 중개자로서 기능한다.
        - 스마트 컨트랙트 기능의 구체적인 설정을 통해 블록체인에게 프로그래밍 가능성과 지능성을 제공해 준다.

02. 스마트 컨트랙트의 설계
    - 설계 과정의 목표: 데이터, 데이터를 처리할 함수, 처리를 위한 규칙
    - 카운터를 위한 유스 케이스 다이어그램(통합 모델 언어: UML) 설계
    - 데이터 애셋, 피어 참여자, 역할, 규칙, 그리고 트랜잭션
        - ex) 카운터 문제
        - 추적해야 할 데이터 애셋: 카운터값
        - 피어 참여자: 카운터값을 업데이트할 애플리케이션
        - 참여자의 역할: 카운터값을 업데이트하고 그 값에 액세스하는 것
        - 데이터와 함수에 검증, 검사해야 할 규칙: 이 유스케이스에는 없음
        - 디지털 장부에 기록해야 하는 트랜잭션: initialize(), increment(), decrement()
    - 클래스 다이어그램에서 컨트랙트 다이어그램으로 변경
        - 클래스 다이어그램: 클래스 이름, 데이터 정의, 함수 정의
        - 컨트랙트 다이어그램: 컨트랙트 이름, 함수 구동 규칙과 접근 규칙(modifier, rules), 데이터 정의, 함수 정의
        - 개발팀원이나 이해 관계자들과 설계 논의 시 사용할 수 있는 편리한 자료
    - 스마트 컨트랙트 코드 작성
        - 솔리디티 언어: 스마트 컨트랙트를 코딩하기 위한 객체지향 고수준 언어. 정적 타입 언어. 상속, 라이브러리, 사용자 정의 타입 등을 지원.
        - pragma solidity: 코드 작성 시 사용한 언어의 버전.
        - contract CONTRACT_NAME {}: 컨트랙트 코드 정의 시작
        - 숫자 타입: uint, int, int256, uint256 => 기본적으로 256비트 값
        - function FUNCTION_NAME {}: 함수 정의
        - 접근 제어자: public(외부, 내부), private(내부), internal(상속), external(외부)
        - Storage 접근: view(밖의 변수들 read 가능, write 불가능), pure(밖의 변수들 read, write 둘 다 불가능), X(밖의 변수들 read, write 가능)
        - 리턴값: 함수 정의에 returns(RETURN_TYPE) 정의 후 return
    - 스마트 컨트랙트 코드를 배포하고 테스트하기(Remix 환경)
        - Remix IDE 주요기능
        - 배포와 테스팅
        - 핵심 사항
            - 스마트 컨트랙트 코드를 블록체인에 배포하였을 때, 블록체인에 정의된 아이덴티티를 가진 누구나 이것에 접근 가능
            - 변조 불가능한 분산 장부를 사용하여 모든 참여자는 해당 스마트 컨트랙트 상 일어난 모든 트랜잭션 리스트와 동일한 카피를 가진다.
    - 블록체인 컨트랙트는 왜 스마트한가?
        - 스마트 컨트랙트의 기능
            - 속성: 이름, 주소, 암호 화폐 잔액, 암호 화폐를 송금하고 수신할 수 있는 내장 기능, 데이터와 함수, 메시지를 수신하고 함수를 호출할 수 있는 내장 기능, 함수 실행을 계산할 수 있는 능력
            - 참여자들의 정보 어카운트. 이더리움 기준
                - EOA(외부 소유 어카운트, externally owned accounts)
                - SCA(스마트 컨트랙트 어카운트, smart contract accounts)
                - 메시지를 보냄으로써 함수 호출이 가능하다. msg.sender, msg.value
    - 탈중앙화 항공사 시스템 유스 케이스(ASK)
        - ASK 정의
            - 유스케이스: 항공사 컨소시엄(ASK)
            - 기존 중앙화된 모델의 이슈들
            - 블록체인 기반 솔루션 제안
            - 솔루션으로 인한 혜택
        - 오퍼레이션 단계
            - 탈중앙화 항공사 시트템에서 참여자의 오퍼레이션을 정의
    - 항공사 스마트 컨트랙트
        - 설계, 유스 케이스, 컨트랙트 다이어그램을 적용해서 유스 케이스와 컨트랙트 다이어그램을 설계하자.
        - 설계 원칙
            - 테스트 체인에서 스마트 컨트랙트를 코딩, 개발 배포하기 전에 우선 설계부터 한다. 또한, 프로덕션 블록체인에 배포하기 전에 철저한 테스트를 거쳐야 한다. 왜냐하면 스마트 컨트랙트는 변조 불가능.
            - 시스템 사용자와 유스 케이스를 정의한다. 사용자란 행위와 입력값을 발생시키고, 설계하고 있는 해당 시스템으로부터 그 출력값을 받는 주체.
            - 컨트랙트 이름, 데이터 애셋, 함수, 함수의 실행과 데이터 접근을 위한 규칙을 정의하는 컨트랙트 다이어그램을 작성.
        - 피어 참여자, 데이터 애셋, 역할, 트랜잭션, 규칙 정의
        - ASK 스마트 컨트랙트의 배포와 테스팅
            - compile 명령 실행
            - deploy 실행
            - test 계획 리스트 설정
    - 스마트 컨트랙트 설계 고려 사항
        - 배포하고 나면 코드를 수정할 수 없는 영구적인 최종 상태가 되기 때문에, 미리 설정 필요
        - 프로덕션용으로 사용하기 전에 스마트 컨트랙트를 철저하게 설계하고 테스트해야 한다.
        - 강력한 기능이 존재하지만, 잘못된 설계와 코딩은 심각한 피해를 초래하기 십상
    - 베스트 프랙티스
        - 블록체인 기능이 개발할 애플리케이션에 반드시 필요한지 확인하자
        - 스마트 컨트랙트가 개발할 애플리케이션에 반드시 필요한지 확인하자
        - 스마트 컨트랙트 코드는 간단하고 일관성 있고 감사 기능하게 작성하자
        - 솔리디티는 자주 업데이트된다는 점을 감안하자

